!function(e){function t(){var t=e.cookie("player");return t?JSON.parse(t):void 0}function r(){for(var e,t=[],r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),a=0;a<r.length;a++)e=r[a].split("="),t.push(e[0]),t[e[0]]=e[1];return t}function a(){if(!k){var r=t()||{};"undefined"==typeof r.theaterMode&&e(window).width()<1280&&(e("html").addClass("theater-mode"),m.trigger("resize"),r.theaterMode=!0,m.trigger("settings.save",[r]))}}function i(){var t=p.triggerHandler("prev.toc"),r=p.triggerHandler("next.toc");e("#player-previous, #player-next").attr("disabled","disabled"),"undefined"!=typeof t&&t.length&&e("#player-previous").removeAttr("disabled"),"undefined"!=typeof r&&r.length&&e("#player-next").removeAttr("disabled")}function o(t,r,a){if(t)return void p.trigger("course.video.error",[t,j,r,n.name,w,n.urls[w]]);e(".mejs-controls").show(),p.trigger("course.video.change",[j,r,N]),N&&(N=null);var o="",n=V[E];if(n.urls[w])o=n.urls[w];else{var s=Object.keys(n.urls),l=s.length>0?s.length-1:0;o=n.urls[s[l]]}e(".mejs-controls").is(":visible")||(e(".mejs-controls").show(),i()),p.trigger("toggle.player.container",["video-container"]),m.trigger("playUrl",[o,a,j,r,n.name,w])}function n(t){t&&(e(".headline-video-title").text(t.VideoTitle),e(".headline-course-title").text(t.CourseTitle),e("h1.default-title").hide(),e(".watching-title").show())}function s(t,r){C=t,e("#banner-thumbnail").hide(),e("#courseplayer").removeClass("hide"),"undefined"!=typeof t&&e.get("/ajax/course/"+ +j+"/"+ +t+"/play").done(function(e){V=e,E=0,o(0===V.length?"No stream information available":null,t,r)}).fail(function(e){o(e,t)})}function l(){e("body").trigger("stream.qualities.available",[m.data("conviva").QualitiesAvailable])}function d(e){var t=m.get(0);if(!isNaN(t.duration)){var r={mediaUrn:"urn:li:lyndaVideo:(urn:li:lyndaCourse:"+j+","+C+")",length:Math.round(t.duration),timeElapsed:Math.round(t.currentTime),volume:100*+t.volume,mediaViewTrackingId:"",isPlaying:!t.paused};return r}}function c(){if(!ve){ve=!0;var t=e("#courseplayer"),r=e("#banner-thumbnail");t.length&&r.length&&(t.removeClass("hide"),r.addClass("hide"))}}function u(t){e(".playback-rates li a[data-playback-rate='"+String(t).replace("0.",".")+"']").click()}function g(){e("body").bind("keydown",function(t){if(!("INPUT"===t.target.tagName||"TEXTAREA"===t.target.tagName||e(t.target).attr("contenteditable")||e(t.target).closest("form").length>0)){var r=m.get(0),a=t.ctrlKey||t.shiftKey||t.altKey||t.metaKey,i=t.ctrlKey||t.altKey||t.metaKey;switch(t.keyCode){case Q:if(a)return!0;c(),r.paused?r.play():r.pause(),me="spacebar";break;case R:var o=r.currentTime;if(t.shiftKey&&!i){var n=h;n-=.25,.5>n&&(n=.5),u(n),me="shift-left"}else{if(a)return!0;o-=10,me="left"}m.trigger("updatetime",o);break;case A:var o=r.currentTime;if(t.shiftKey&&!i){var n=h;n+=.25,n>2&&(n=2),u(n),me="shift-right"}else{if(a)return!0;o+=10,me="right"}m.trigger("updatetime",o);break;case q:case O:case S:case D:case L:case U:case z:case X:case G:case J:case W:case B:case F:case Y:case _:case Z:case $:case ee:case te:case re:var s,l=r.duration,d=l/10;s=t.keyCode<58?t.keyCode-48:t.keyCode-96;var o=s*d;isNaN(o)&&(o=0),m.trigger("updatetime",o),me="number-"+s;break;case ie:if(a)return!0;m.trigger("fullscreen"),me="F";break;case oe:case ue:if(a)return!0;m.trigger("updatetime",0),me="home",t.keyCode==oe&&(me="O");break;case ge:var l=r.duration-.5;m.trigger("updatetime",l),me="end";break;case ae:if(a)return!0;m.trigger("viewMode"),me="D";break;case ne:if(a)return!0;m.trigger("previous"),me="J";break;case se:if(a)return!0;m.trigger("pause"),me="K";break;case le:if(a)return!0;m.trigger("next"),me="L";break;case de:if(a)return!0;k||m.trigger("popout"),me="P";break;case ce:if(a)return!0;m.trigger("theater.toggle"),e("body").trigger("ga.event",{action:"keypress",label:"player-theater-mode"});break;case pe:if(a)return!0;var g=r.volume+.05;g>1&&(g=1),r.volume=g,me="up-arrow";break;case fe:if(a)return!0;var g=r.volume-.05;0>g&&(g=0),r.volume=g,me="down-arrow";break;default:return!0}return p.trigger("ga.event",{action:"keypress",label:me,value:j}),!1}})}var p=e("body"),f=e(window),m=e("#courseplayer video.player"),v=m.data("continuousPlay"),y=m.data("autostart"),h=m.data("playbackRate")||1,w=m.data("quality")||540,b=e("#course-page"),k=b.hasClass("course-popout"),j=+b.data("courseId"),C=+b.data("initialVideoId"),T=+b.data("initialVideoId"),I=m.data("logViews")||!0,x=!1,E=(e(".course-toc"),0),V=[],N=null,K=null,H=e("html").hasClass("no-touch"),M=!1;v=!!v,e(".mejs-time-total").append('<span class="mejs-time-float-custom"></span>'),e(".mejs-time-total").append('<span class="mejs-time-handle-custom"></span>'),f.on("popstate",function(e){if(null!==e.originalEvent.state){var t=e.originalEvent.state&&e.originalEvent.state.id?+e.originalEvent.state.id:T;N=!0,s(t)}}),m.on("loadstart",function(){l();var e=m.find("track").data("initial");return e?void m.find("track").data("initial",null):(m.trigger("track.load","/ajax/player/transcript?courseId="+j+"&videoId="+C),void(x=!1))}),k&&(l(),e("#courseplayer").find(".view-mode").hide(),e("#courseplayer").find(".mejs-container").addClass("is-popout")),m.on("play",function(t){e("#courseplayer").find(".mejs-time-float").hide(),0===t.target.currentTime&&I&&!x&&(e.ajax({url:"/ajax/course/player/video/view?videoId="+C,cache:!1,success:function(t){if(t.IsComplete){var r=e("#course-info").parent();e.get("/course/certificate/"+j).done(function(t){e(t.html).insertBefore(r)})}}}),e("i.popover-trigger[data-videoid="+C+"]").addClass("eye"),"undefined"!=typeof opener&&opener&&e("i.popover-trigger[data-ga-value="+C+"]",window.opener.document).addClass("eye"),x=!0)}).on("playing",function(e){i(),m.get(0).playbackRate=h}).on("next",function(){var e=p.triggerHandler("next.toc");if(e){if(p.triggerHandler("is.last.toc",[e.id,e.type]))return;e.find(".item-name").trigger("click")}}).on("previous",function(){var e=p.triggerHandler("prev.toc");e&&e.find(".item-name").trigger("click")}).on("ended",function(){var t=p.triggerHandler("is.last.toc",[C,"video"]);return t?void p.trigger("course.ended"):void(v&&e(this).trigger("next"))}).on("timeupdate",function(e){p.trigger("course.video.timeupdate",[e,C])}).on("streamQuality",function(e,t){w=t,0===V.length?s(C,m.get(0).currentTime):o(null,C,m.get(0).currentTime)}).on("viewMode",function(){p.trigger("course.video.viewmode")}).on("getCurrentVideoId",function(){p.trigger("course.get.video.id",C)}).on("continuousPlay",function(e,t){v=t}).on("playbackRate",function(e,t){h=t}).on("error",function(t){var r=V[E];e(this).trigger("course.video.error",[j,C,r.name,w,r.urls[w]])}).on("updatetime",function(e,t){var r=m.get(0);M?(r.setCurrentTime(t),r.play()):(r.addEventListener("loadedmetadata",function(){this.setCurrentTime(t),this.play()}),r.load())}).on("playVideoId",function(e,t,r){s(t,r||0)}).on("popout",function(t){m.get(0).pause();var r=m.innerHeight()/m.innerWidth(),a=1130,i=e("#courseplayer .mejs-controls"),o=Math.ceil(a*r)+i.height(),n=parseInt(m.get(0).currentTime,10),s=window.screenLeft?window.screenLeft:window.screenX,l=window.screenTop?window.screenTop:window.screenY,d=s+window.innerWidth/2-a/2,c=l+window.innerHeight/2-o/2;K=window.open("/course/popout/"+j+"/"+C+"?tc="+n,"","resizable=yes, height = "+o+", width = "+a+", top="+c+", left="+d),e(".mejs-popout-layer").show(),e(".mejs-controls").prepend('<div class="controls-overlay"></div>')}).on("popoutClose",function(t){e(".mejs-popout-layer").hide(),e(".mejs-controls .controls-overlay").remove(),K.jQuery(K).trigger("popoutCloseSelf")}).on("theater.toggle",function(r){e("html").toggleClass("theater-mode"),m.trigger("resize");var a=e("html").hasClass("theater-mode"),i=t()||{};i.theaterMode=a,m.trigger("settings.save",[i]),p.trigger("theater.toggle.done")}).on("video.metadata.loaded",function(e,t){n(t)}).on("play pause loadedmetadata",function(){var e=d();e&&p.trigger("li.track.action",["PlayerPlayPauseEvent",{reason:"USER_TRIGGERED",state:e}])}).on("loadedmetadata",function(e){M=!0}).on("video.error",function(e){var r,a=m.data("conviva"),i=a.QualitiesAvailable;if(i){for(r=0;r<i.length&&parseInt(i[r])!==w;r++);if(r>0){var n=w;w=parseInt(i[r-1]),m.trigger("log.message",{code:9901,message:"VideoError: Changing video quality",data:"Quality changed from "+n+" to "+w+". VideoId: "+C}),o(!1,C,0)}else if(V&&!E+1===V.length){var s=E;E+=1;var l=t()||{};w="undefined"!=typeof l.quality?l.quality:540,m.trigger("log.message",{code:9902,message:"VideoError: Changing CDN",data:"CDN changed from "+V[s].name+" to "+V[E].name}),o(!1,C,0)}}}),H&&a(),window.onunload=function(){"undefined"!=typeof opener&&opener&&opener.jQuery(opener).trigger("popoutClosing",[m.get(0).currentTime])},f.on("popoutClosing",function(t,r){e(".mejs-controls .controls-overlay").remove(),e(".mejs-popout-layer").hide(),m.trigger("updatetime",r)}),f.on("popoutCloseSelf",function(){self.close()}),p.on("play.video.by.id",function(e,t){s(t)}),p.on("mousemove",".mejs-time-rail",function(t){e(".mejs-time-handle").css("display","none");var r=e(this).parent().offset(),a=t.pageX-r.left,i=a-8,o=e(".mejs-time-float-custom"),n=i;e(".mejs-time-handle-custom").css({left:i,display:"block"});var s=11,l=e(".mejs-time-rail").width()-35,d=e(".mejs-time-float").html();s>i&&(n=s),i>l&&(n=l),n-=s,o.css({left:n,display:"block"}).html(d)}),p.on("mouseout",".mejs-time-rail",function(t){e(".mejs-time-handle-custom").css({display:"none"}),e(".mejs-time-float-custom").css({display:"none"})}),p.on("mouseenter, mousemove",".mejs-container-fullscreen",function(t){e(".mejs-controls").show()}),p.on("mouseleave",".mejs-container-fullscreen",function(t){e(".mejs-controls").fadeOut()}),p.on("click",".postroll-controls-replay",function(e){var t=p.triggerHandler("prev.toc");t.length&&t.find(".item-name").trigger("click")}),H&&g();var P=r();P&&P.tc?setTimeout(function(){var t=e("#courseplayer video.player"),r=parseInt(P.tc,10);t.trigger("playVideoId",[C,r])},500):y&&(m.trigger("playVideoId",[C,0]),y=!1);var Q=32,R=37,A=39,q=48,O=49,S=50,D=51,L=52,U=53,z=54,X=55,G=56,J=57,W=96,B=97,F=98,Y=99,_=100,Z=101,$=102,ee=103,te=104,re=105,ae=68,ie=70,oe=79,ne=74,se=75,le=76,de=80,ce=84,ue=36,ge=35,pe=38,fe=40,me="",ve=!1}(jQuery);